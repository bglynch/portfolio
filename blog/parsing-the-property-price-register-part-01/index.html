<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit inherit; background-repeat: inherit inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.701961); color: rgb(85, 85, 85); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit inherit; background-repeat: inherit inherit; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; background-repeat: initial initial; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print { 
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid-page; break-before: avoid-page; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid-page; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; background-position: initial initial; background-repeat: initial initial; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; background-position: initial initial; background-repeat: initial initial; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-fences-math .MathJax_SVG_Display, .md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: visible; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background-color: rgb(255, 255, 0); color: rgb(0, 0, 0); background-position: initial initial; background-repeat: initial initial; }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print { 
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix foreignObject { font-size: var(--mermaid-font-zoom); }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-math .MathJax_SVG_Display { margin-top: 8px; cursor: default; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow-y: auto; padding-bottom: 30px; padding-top: 60px; width: 300px; overflow-x: hidden; }
@media screen and (max-width: 1024px) { 
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) { 
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571429rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ''; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ''; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ''; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: '−'; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; background-repeat: initial initial; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); background-position: initial initial; background-repeat: initial initial; }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}


 :root {--mermaid-font-zoom:1em ;}  @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}
</style>
<link rel="stylesheet" href="blog.css">
<title>Parsing the Property Price Register</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='parsing-the-price-property-register'>Parsing the Price Property Register <br>Part 01: Eircode, County and Dublin Postcode</h1><p>by <a href="https://www.bglynch.com/">Brian Lynch</a></p><p><img src="images/hero.jpg" referrerpolicy="no-referrer" alt="toa-heftiba-nrSzRUWqmoI-unsplash"></p><p><em>Photo by <a href='https://unsplash.com/@heftiba?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText'>Toa Heftiba</a> on <a href='https://unsplash.com/s/photos/houses?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText'>Unsplash</a></em></p><h2 id='introduction'>Introduction</h2><blockquote><p><em>The Residential Property Price Register is produced by the Property Services Regulatory Authority (PSRA) pursuant to section 86 of the Property Services (Regulation) Act 2011. It includes Date of Sale, Price and Address of all residential properties purchased in Ireland since the 1st January 2010, as declared to the Revenue Commissioners for stamp duty purposes.</em></p></blockquote><p>Anyone who has attempted to work with the data from Ireland’s Price Property Register will know that the dataset can be a bit of a mess.</p><p>We will attempt to tidy it up by extracting structured data from the semi-structured address string.</p><p>By the end of this blog we will have <strong>improved almost 50% of the rows</strong> in the dataset.</p><p>Currently the dataset has approximatly 450,000 rows. The columns in the dataset are:</p><ul><li>Date of Sale</li><li>Address</li><li>Postal Code</li><li>County</li><li>Price</li><li>Not Full Market Price</li><li>VAT Exclusive</li><li>Property Size Description</li><li>Description of Property</li></ul><p>The ones we are interested in are <strong>Address</strong>, <strong>Postal Code</strong> and <strong>County</strong>.</p><p>In many rows in the dataset, the Address can contain County information Postal Code information...or both.</p><h3 id='aim'>Aim</h3><p>Our aim is to remove this information from the address string and update the Postcode or County information where necessary.</p><h5 id='examples'>Examples</h5><figure><table><thead><tr><th>Address</th><th>Cleaned Data</th></tr></thead><tbody><tr><td>1 MEADOW AVENUE, DUNDRUM, DUBLIN 14</td><td><strong>address</strong> = 1 Meadow Avenue, Dundrum <br><strong>postcode</strong>=Dublin 14</td></tr><tr><td>44 ALLEN PARK ROAD, STILLORGAN, COUNTY DUBLIN</td><td><strong>address</strong> = 44 Allen Park Road, Stillorgan <br><strong>county</strong> = Dublin</td></tr><tr><td>1 INFIRMARY RD, DUBLIN 7, DUBLIN</td><td><strong>address</strong> = 1 Infirmary rd<br><strong>postcode</strong> = Dublin 7<br><strong>county</strong> = Dublin</td></tr></tbody></table></figure><h3 id='tools-for-the-job'>Tools for the job</h3><ul><li>python</li><li>pandas</li><li>regex</li><li>sqlite3</li><li>Jupyter Notebooks</li><li>DB Browser for sqlite</li></ul><h3 id='method'>Method</h3><h4 id='data-preperation-1'>Data preperation</h4><p>PPR data is attained as a csv file. Pandas will be used to load the data, modify the column names and create a uuid for each row.</p><p>This will be exported to a sqlite database.</p><h4 id='address-cleaning'>Address cleaning</h4><p>First we will normalise the eircode, county and postal code substrings in each address. Each will be normalised to an easily extractable pattern.</p><p>Testing will be used to create the normalisation and extraction functions</p><blockquote><p><em>regex will play a major role in creating these functions</em></p></blockquote><p>Extraction will be done in order of structure</p><ol><li>Eircode: Rigid structure of a key followed by 4 alphanumeric characters</li><li>Postcode: “Dublin” or “D” followed by a postcode number</li><li>County: Different spellings of “county”, followed by County Name</li></ol><h2 id='data-preperation-2'>Data Preperation</h2><p>The PPR dataset can be downloaded here: <a href='https://propertypriceregister.ie/Website/NPSRA/pprweb.nsf/page/ppr-home-en' target='_blank' class='url'>https://propertypriceregister.ie/Website/NPSRA/pprweb.nsf/page/ppr-home-en</a></p><p>We will use pandas to prepare the data and save it to a sqlite database</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import <span class="cm-variable">sqlite3</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import <span class="cm-variable">pandas <span class="cm-keyword">as <span class="cm-variable">pd</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from <span class="cm-variable">hashlib <span class="cm-keyword">import <span class="cm-variable">blake2b</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># load data</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">pd.<span class="cm-property">read_csv(<span class="cm-string">"../data/raw/PPR-ALL.csv", <span class="cm-variable">encoding=<span class="cm-string">'latin-1')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># rename columns</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">df.<span class="cm-property">rename(<span class="cm-variable">columns={</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'Date of Sale (dd/mm/yyyy)': <span class="cm-string">'date',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'Address': <span class="cm-string">'address',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'Postal Code': <span class="cm-string">'postcode',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'County': <span class="cm-string">'county',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'Price (\x80)': <span class="cm-string">'price',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'Not Full Market Price': <span class="cm-string">'not_full_market_price',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'VAT Exclusive': <span class="cm-string">'vat_exclusive',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'Property Size Description': <span class="cm-string">'floor_area',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'Description of Property': <span class="cm-string">'construction',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># create uuid for each row</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for <span class="cm-variable">row <span class="cm-keyword">in <span class="cm-variable">df.<span class="cm-property">copy().<span class="cm-property">itertuples():</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">hash_id_string = <span class="cm-string">f"{row.date}{row.address}{row.postcode}{row.county}{row.price}{row.not_full_market_price}{row.vat_exclusive}{row.floor_area}{row.construction}"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">df.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'uuid'] = <span class="cm-variable">blake2b(<span class="cm-builtin">bytes(<span class="cm-variable">hash_id_string, <span class="cm-string">"utf-8"), <span class="cm-variable">digest_size=<span class="cm-number">5).<span class="cm-property">hexdigest()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># remove duplicates</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">drop_duplicates(<span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># set index to 'uuid'</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">set_index(<span class="cm-string">'uuid', <span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">db_url = <span class="cm-string">"../data/database.db"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-variable">db_url)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur = <span class="cm-variable">conn.<span class="cm-property">cursor()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">to_sql(<span class="cm-string">'ppr_all', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">close()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 884px;"></div><div class="CodeMirror-gutters" style="display: none; height: 884px;"></div></div></div></pre><p>Now we have the PPR data in a sqlite database.</p><h3 id='create-tempoary-data-table'>Create tempoary data table</h3><p>We will create a temporary table to iterate over while we are creating the functions to normalise and extract data.</p><p>Dummy columns are added to store our extracted data.</p><p>To do this, we will again use pandas.</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'../data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">pd.<span class="cm-property">read_sql_query(<span class="cm-string">'SELECT * FROM ppr_all', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">set_index(<span class="cm-string">'uuid', <span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">df.<span class="cm-property">drop([<span class="cm-string">"date",<span class="cm-string">"price",<span class="cm-string">"not_full_market_price",<span class="cm-string">"construction",<span class="cm-string">"floor_area",<span class="cm-string">"vat_exclusive"], <span class="cm-variable">axis=<span class="cm-number">1)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">insert(<span class="cm-number">3, <span class="cm-string">'ex_eircode', <span class="cm-keyword">None)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">insert(<span class="cm-number">3, <span class="cm-string">'ex_county', <span class="cm-keyword">None)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">insert(<span class="cm-number">3, <span class="cm-string">'ex_postcode', <span class="cm-keyword">None)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">insert(<span class="cm-number">3, <span class="cm-string">'address_mod', <span class="cm-keyword">None)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">address</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur = <span class="cm-variable">conn.<span class="cm-property">cursor()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">execute(<span class="cm-string">f"DROP TABLE IF EXISTS temp;")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">to_sql(<span class="cm-string">'temp', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">close()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 406px;"></div><div class="CodeMirror-gutters" style="display: none; height: 406px;"></div></div></div></pre><p>Below is a view of the temp table created.</p><p><img src="images/image-20210425110822447.png" referrerpolicy="no-referrer" alt="image-20210425110822447"></p><h2 id='eircode-extraction'>Eircode Extraction</h2><p><img src="images/eircode.png" referrerpolicy="no-referrer" alt="eircode" style="max-height: 150px;"></p><p>Eircodes are quite structured, so there shouldn’t be a need to normalise the address before extraction.</p><p>There are 139 eircode routing keys, so we will look for one of these plus 4 succeeding alphanumeric characters.</p><p>Eircode routing keys can be found here: <a href='https://www.autoaddress.ie/blog/autoaddressblog/2016/09/21/eircode-routing-keys' target='_blank' class='url'>https://www.autoaddress.ie/blog/autoaddressblog/2016/09/21/eircode-routing-keys</a></p><h3 id='extract-an-eircode-from-an-address'>Extract an Eircode from an address</h3><p>First we will create some tests.</p><h5 id='eircode-extraction-tests'>eircode extraction tests</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_extract_eircode(<span class="cm-variable-2">self):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">ex.<span class="cm-property">extract_eircode_from_end_of_address(<span class="cm-string">'1 Some Place, K67 KR86'), <span class="cm-string">"K67 KR86")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">ex.<span class="cm-property">extract_eircode_from_end_of_address(<span class="cm-string">'1 Some Place K67 KR86'), <span class="cm-string">"K67 KR86")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">ex.<span class="cm-property">extract_eircode_from_end_of_address(<span class="cm-string">'1 Some Place, K67KR86'), <span class="cm-string">"K67 KR86")</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 96px;"></div><div class="CodeMirror-gutters" style="display: none; height: 96px;"></div></div></div></pre><p>Now we will write our funciton to pass the tests.</p><h5 id='eircode-extraction-function'>eircode extraction function</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">extract_eircode_from_end_of_address(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">address.<span class="cm-property">lower().<span class="cm-property">strip(<span class="cm-string">' ,.')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">eircode_routing_keys = [</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'a41', <span class="cm-string">'a42', <span class="cm-string">'a45', <span class="cm-string">'a63', <span class="cm-string">'a67', <span class="cm-string">'a75', <span class="cm-string">'a81', <span class="cm-string">'a82', <span class="cm-string">'a83', <span class="cm-string">'a84', <span class="cm-string">'a85', <span class="cm-string">'a86', <span class="cm-string">'a91', <span class="cm-string">'a92', <span class="cm-string">'a94', <span class="cm-string">'a96',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'a98', <span class="cm-string">'c15', <span class="cm-string">'d01', <span class="cm-string">'d02', <span class="cm-string">'d03', <span class="cm-string">'d04', <span class="cm-string">'d05', <span class="cm-string">'d06', <span class="cm-string">'d6w', <span class="cm-string">'d07', <span class="cm-string">'d08', <span class="cm-string">'d09', <span class="cm-string">'d10', <span class="cm-string">'d11', <span class="cm-string">'d12', <span class="cm-string">'d13',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'d14', <span class="cm-string">'d15', <span class="cm-string">'d16', <span class="cm-string">'d17', <span class="cm-string">'d18', <span class="cm-string">'d20', <span class="cm-string">'d22', <span class="cm-string">'d24', <span class="cm-string">'e21', <span class="cm-string">'e25', <span class="cm-string">'e32', <span class="cm-string">'e34', <span class="cm-string">'e41', <span class="cm-string">'e45', <span class="cm-string">'e53', <span class="cm-string">'e91',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'f12', <span class="cm-string">'f23', <span class="cm-string">'f26', <span class="cm-string">'f28', <span class="cm-string">'f31', <span class="cm-string">'f35', <span class="cm-string">'f42', <span class="cm-string">'f45', <span class="cm-string">'f52', <span class="cm-string">'f56', <span class="cm-string">'f91', <span class="cm-string">'f92', <span class="cm-string">'f93', <span class="cm-string">'f94', <span class="cm-string">'h12', <span class="cm-string">'h14',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'h16', <span class="cm-string">'h18', <span class="cm-string">'h23', <span class="cm-string">'h53', <span class="cm-string">'h54', <span class="cm-string">'h62', <span class="cm-string">'h65', <span class="cm-string">'h71', <span class="cm-string">'h91', <span class="cm-string">'k32', <span class="cm-string">'k34', <span class="cm-string">'k36', <span class="cm-string">'k45', <span class="cm-string">'k56', <span class="cm-string">'k67', <span class="cm-string">'k78',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'n37', <span class="cm-string">'n39', <span class="cm-string">'n41', <span class="cm-string">'n91', <span class="cm-string">'p12', <span class="cm-string">'p14', <span class="cm-string">'p17', <span class="cm-string">'p24', <span class="cm-string">'p25', <span class="cm-string">'p31', <span class="cm-string">'p32', <span class="cm-string">'p36', <span class="cm-string">'p43', <span class="cm-string">'p47', <span class="cm-string">'p51', <span class="cm-string">'p56',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'p61', <span class="cm-string">'p67', <span class="cm-string">'p72', <span class="cm-string">'p75', <span class="cm-string">'p81', <span class="cm-string">'p85', <span class="cm-string">'r14', <span class="cm-string">'r21', <span class="cm-string">'r32', <span class="cm-string">'r35', <span class="cm-string">'r42', <span class="cm-string">'r45', <span class="cm-string">'r51', <span class="cm-string">'r56', <span class="cm-string">'r93', <span class="cm-string">'r95',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'t12', <span class="cm-string">'t23', <span class="cm-string">'t34', <span class="cm-string">'t45', <span class="cm-string">'t56', <span class="cm-string">'v14', <span class="cm-string">'v15', <span class="cm-string">'v23', <span class="cm-string">'v31', <span class="cm-string">'v35', <span class="cm-string">'v42', <span class="cm-string">'v92', <span class="cm-string">'v93', <span class="cm-string">'v94', <span class="cm-string">'v95', <span class="cm-string">'w12',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'w23', <span class="cm-string">'w34', <span class="cm-string">'w91', <span class="cm-string">'x35', <span class="cm-string">'x42', <span class="cm-string">'x91', <span class="cm-string">'y14', <span class="cm-string">'y21', <span class="cm-string">'y25', <span class="cm-string">'y34', <span class="cm-string">'y35'</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ]</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">regex = <span class="cm-string">r"\b(" <span class="cm-operator">+ <span class="cm-string">'|'.<span class="cm-property">join(<span class="cm-variable">eircode_routing_keys) <span class="cm-operator">+ <span class="cm-string">r") ?([a-z0-9]{4})$"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">regex_result = <span class="cm-variable">re.<span class="cm-property">search(<span class="cm-variable">regex, <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">eircode = <span class="cm-keyword">None</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">regex_result <span class="cm-keyword">is <span class="cm-keyword">not <span class="cm-keyword">None:</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">eircode = <span class="cm-string">f"{regex_result.group(1)} {regex_result.group(2)}".<span class="cm-property">upper()</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">eircode</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 454px;"></div><div class="CodeMirror-gutters" style="display: none; height: 454px;"></div></div></div></pre><blockquote><p><em>Eircode can now be successfully extracted from an address</em></p></blockquote><h3 id='remove-an-eircode-from-an-address'>Remove an Eircode from an address</h3><p>Again, we will write test first.</p><h5 id='eircode-removal-tests'>eircode removal tests</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_parse_address_of_eircode(<span class="cm-variable-2">self):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">pr.<span class="cm-property">parse_address_of_eircode(<span class="cm-string">'1 Some Place, K67 KR86'), <span class="cm-string">"1 Some Place")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">pr.<span class="cm-property">parse_address_of_eircode(<span class="cm-string">'1 Some Place K67 KR86'), <span class="cm-string">"1 Some Place")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">pr.<span class="cm-property">parse_address_of_eircode(<span class="cm-string">'1 Some Place, K67KR86'), <span class="cm-string">"1 Some Place")</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 96px;"></div><div class="CodeMirror-gutters" style="display: none; height: 96px;"></div></div></div></pre><p>And now, we will write the function so all the tests pass. This workflow will be common throughout.</p><h5 id='eircode-removal-function'>eircode removal function</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">parse_address_of_eircode(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">address.<span class="cm-property">strip(<span class="cm-string">' ,.')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">eircode_routing_keys = [</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'a41', <span class="cm-string">'a42', <span class="cm-string">'a45', <span class="cm-string">'a63', <span class="cm-string">'a67', <span class="cm-string">'a75', <span class="cm-string">'a81', <span class="cm-string">'a82', <span class="cm-string">'a83', <span class="cm-string">'a84', <span class="cm-string">'a85', <span class="cm-string">'a86', <span class="cm-string">'a91', <span class="cm-string">'a92', <span class="cm-string">'a94', <span class="cm-string">'a96',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'a98', <span class="cm-string">'c15', <span class="cm-string">'d01', <span class="cm-string">'d02', <span class="cm-string">'d03', <span class="cm-string">'d04', <span class="cm-string">'d05', <span class="cm-string">'d06', <span class="cm-string">'d6w', <span class="cm-string">'d07', <span class="cm-string">'d08', <span class="cm-string">'d09', <span class="cm-string">'d10', <span class="cm-string">'d11', <span class="cm-string">'d12', <span class="cm-string">'d13',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'d14', <span class="cm-string">'d15', <span class="cm-string">'d16', <span class="cm-string">'d17', <span class="cm-string">'d18', <span class="cm-string">'d20', <span class="cm-string">'d22', <span class="cm-string">'d24', <span class="cm-string">'e21', <span class="cm-string">'e25', <span class="cm-string">'e32', <span class="cm-string">'e34', <span class="cm-string">'e41', <span class="cm-string">'e45', <span class="cm-string">'e53', <span class="cm-string">'e91',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'f12', <span class="cm-string">'f23', <span class="cm-string">'f26', <span class="cm-string">'f28', <span class="cm-string">'f31', <span class="cm-string">'f35', <span class="cm-string">'f42', <span class="cm-string">'f45', <span class="cm-string">'f52', <span class="cm-string">'f56', <span class="cm-string">'f91', <span class="cm-string">'f92', <span class="cm-string">'f93', <span class="cm-string">'f94', <span class="cm-string">'h12', <span class="cm-string">'h14',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'h16', <span class="cm-string">'h18', <span class="cm-string">'h23', <span class="cm-string">'h53', <span class="cm-string">'h54', <span class="cm-string">'h62', <span class="cm-string">'h65', <span class="cm-string">'h71', <span class="cm-string">'h91', <span class="cm-string">'k32', <span class="cm-string">'k34', <span class="cm-string">'k36', <span class="cm-string">'k45', <span class="cm-string">'k56', <span class="cm-string">'k67', <span class="cm-string">'k78',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'n37', <span class="cm-string">'n39', <span class="cm-string">'n41', <span class="cm-string">'n91', <span class="cm-string">'p12', <span class="cm-string">'p14', <span class="cm-string">'p17', <span class="cm-string">'p24', <span class="cm-string">'p25', <span class="cm-string">'p31', <span class="cm-string">'p32', <span class="cm-string">'p36', <span class="cm-string">'p43', <span class="cm-string">'p47', <span class="cm-string">'p51', <span class="cm-string">'p56',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'p61', <span class="cm-string">'p67', <span class="cm-string">'p72', <span class="cm-string">'p75', <span class="cm-string">'p81', <span class="cm-string">'p85', <span class="cm-string">'r14', <span class="cm-string">'r21', <span class="cm-string">'r32', <span class="cm-string">'r35', <span class="cm-string">'r42', <span class="cm-string">'r45', <span class="cm-string">'r51', <span class="cm-string">'r56', <span class="cm-string">'r93', <span class="cm-string">'r95',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'t12', <span class="cm-string">'t23', <span class="cm-string">'t34', <span class="cm-string">'t45', <span class="cm-string">'t56', <span class="cm-string">'v14', <span class="cm-string">'v15', <span class="cm-string">'v23', <span class="cm-string">'v31', <span class="cm-string">'v35', <span class="cm-string">'v42', <span class="cm-string">'v92', <span class="cm-string">'v93', <span class="cm-string">'v94', <span class="cm-string">'v95', <span class="cm-string">'w12',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'w23', <span class="cm-string">'w34', <span class="cm-string">'w91', <span class="cm-string">'x35', <span class="cm-string">'x42', <span class="cm-string">'x91', <span class="cm-string">'y14', <span class="cm-string">'y21', <span class="cm-string">'y25', <span class="cm-string">'y34', <span class="cm-string">'y35'</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ]</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">regex = <span class="cm-string">r"\b(" <span class="cm-operator">+ <span class="cm-string">'|'.<span class="cm-property">join(<span class="cm-variable">eircode_routing_keys) <span class="cm-operator">+ <span class="cm-string">r") ?[a-z0-9]{4}$"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-variable">regex, <span class="cm-string">'', <span class="cm-variable">address, <span class="cm-variable">flags=<span class="cm-variable">re.<span class="cm-property">IGNORECASE).<span class="cm-property">rstrip(<span class="cm-string">', ')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">address</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 406px;"></div><div class="CodeMirror-gutters" style="display: none; height: 406px;"></div></div></div></pre><blockquote><p><em>Eircode can now be successfully removed from an address</em></p></blockquote><h3 id='extract-eircode-from-address'>Extract Eircode from address</h3><p>Now we will loop over the database and extract/remove eircode from address containing them.</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'../data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">pd.<span class="cm-property">read_sql_query(<span class="cm-string">'SELECT * FROM temp;', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">set_index(<span class="cm-string">'uuid', <span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for <span class="cm-variable">row <span class="cm-keyword">in <span class="cm-variable">df.<span class="cm-property">copy().<span class="cm-property">itertuples():</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">eircode = <span class="cm-variable">ex.<span class="cm-property">extract_eircode_from_end_of_address(<span class="cm-variable">row.<span class="cm-property">address_mod)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">eircode <span class="cm-keyword">is <span class="cm-keyword">not <span class="cm-keyword">None:</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'ex_eircode'] = <span class="cm-variable">eircode</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'address_mod'] = <span class="cm-variable">pr.<span class="cm-property">parse_address_of_eircode(<span class="cm-variable">row.<span class="cm-property">address_mod)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur = <span class="cm-variable">conn.<span class="cm-property">cursor()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">execute(<span class="cm-string">f"DROP TABLE IF EXISTS temp;")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">to_sql(<span class="cm-string">'temp', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">close()</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p>Now after opening the database, we can see we have sucessfully extracted <strong>35</strong> eircodes. </p><p>Considering Eircodes were introduced in July 2015, which accounts for over half of the rows in the database, this is a disappointing return.</p><p>Its is approximatly <strong>0.0001%</strong> of address.</p><p><img src="images/db-eircode.png" referrerpolicy="no-referrer" alt="image-20210426105039237"></p><h2 id='dublin-postcode-extraction'>Dublin Postcode Extraction</h2><p><img src="images/postcode.jpeg" referrerpolicy="no-referrer" alt="Leeson_St_-_Hatch_St_nameplates"></p><p>Dublin postcodes are next in line in terms of structure. They are typically written as “Dublin” followed by the postcode number. This will not be the case for all addresses, so we will need to normalise the address before attempting extraction.</p><p>There are 22 Dublin postcodes, and a list can be found here: <a href='https://en.wikipedia.org/wiki/List_of_Dublin_postal_districts' target='_blank' class='url'>https://en.wikipedia.org/wiki/List_of_Dublin_postal_districts</a></p><h3 id='normalising-the-address-for-dublin-postcodes'>Normalising the address for Dublin Postcodes</h3><p>From scanning through the database, we have extracted some tests for our normalisation function. We will attempt to normalise each postcode to the format of <strong>dublin_{postcode_number}</strong></p><h5 id='postcode-normalisation-tests-1'>Postcode normalisation tests</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_normalise_dublin_postcode(<span class="cm-variable-2">self):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 4'), &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_4")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 04'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_4")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 14'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_14")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 6w'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_6w")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 6 west'), &nbsp;<span class="cm-string">"1 some place, dublin_6w")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin. 15'), &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 15.'), &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d9'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_9")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d 15'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d/15'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d.15'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d. 15'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place dublin 10, dublin 10'), <span class="cm-string">"1 place, dublin_10")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place dublin 10, town'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 place dublin_10, town")</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><h5 id='postcode-normalisation-function-1'>Postcode normalisation function</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">normalise_dublin_postcode(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">address.<span class="cm-property">lower().<span class="cm-property">strip(<span class="cm-string">',. ')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r'\bd(ublin)? *6 *(west|w)\b', <span class="cm-string">'dublin_6w', <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r'dublin\.? 0?(\d+)', <span class="cm-string">r'dublin_\1', <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" d[ /\.]*([012]?[0-9]w?)\b", <span class="cm-string">r" dublin_\1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"\b(dublin_([12]?[0-9]w?)),? \1$", <span class="cm-string">r", dublin_\2", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" ?,[, ]+", <span class="cm-string">r", ", <span class="cm-variable">address)</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">address</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 191px;"></div><div class="CodeMirror-gutters" style="display: none; height: 191px;"></div></div></div></pre><p>We will run this function through or database to see how many address were normalised and <strong>search for outliers</strong> that aren’t represented in our tests.</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">pd.<span class="cm-property">read_sql_query(<span class="cm-string">'SELECT * FROM temp;', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">set_index(<span class="cm-string">'uuid', <span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">address_mod = <span class="cm-variable">df.<span class="cm-property">address_mod.<span class="cm-property">apply(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur = <span class="cm-variable">conn.<span class="cm-property">cursor()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">execute(<span class="cm-string">f"DROP TABLE IF EXISTS temp;")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">to_sql(<span class="cm-string">'temp', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">close()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 263px;"></div><div class="CodeMirror-gutters" style="display: none; height: 263px;"></div></div></div></pre><p>&nbsp;</p><h4 id='look-for-outliers-1'>Look for outliers</h4><p><strong>DB Browser for Sqlite</strong> allows for <strong>regex searching</strong> which is extremely useful for this.</p><h6 id='example-search-for-misspellings-of-dublin-with-a-number-after-regex-dublin-dw'>Example: Search for misspellings of dublin with a number after (regex: /d[ublin ]*[\dw]+$/)</h6><p><img src="images/db-postcode-1.png" referrerpolicy="no-referrer" alt="image-20210427144902431"></p><p>Here are some examples of rows that were not picked up by out original tests.</p><figure><table><thead><tr><th>address</th><th>error</th></tr></thead><tbody><tr><td>1 airpark square, rathfarnham, dublin16</td><td>no space between dublin and number</td></tr><tr><td>111 marlborough road, donnybrook, dublin  4</td><td>double space between dublin and number</td></tr><tr><td>11 the alders, carrington, santry  dubllin 9</td><td>misspelling of dublin</td></tr></tbody></table></figure><p>We will add all outliers found to our tests</p><h4 id='postcode-normalisation-tests-2'>Postcode normalisation tests</h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_normalise_dublin_postcode(<span class="cm-variable-2">self):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin4'), &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_4")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 4'), &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_4")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin  4'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_4")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 04'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_4")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 14'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_14")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 6w'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_6w")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 6 west'), &nbsp;<span class="cm-string">"1 some place, dublin_6w")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin. 15'), &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, dublin 15.'), &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d9'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_9")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d 15'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d/15'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d.15'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 some place, d. 15'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin_15")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place dublin 10, dublin 10'), <span class="cm-string">"1 place, dublin_10")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place dublin 10, town'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 place, dublin_10, town")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, towndublin 6'), &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 place, town, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># no change test</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'apt 58, block d2, town'), &nbsp; &nbsp; &nbsp; <span class="cm-string">"apt 58, block d2, town")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'apt d4, harvey dock, youghal'), <span class="cm-string">"apt d4, harvey dock, youghal")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'place, apt d07 student accom'), <span class="cm-string">"place, apt d07 student accom")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'apt &nbsp; d4, corm apts, foxford'), <span class="cm-string">"apt d4, corm apts, foxford")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># bad spellings</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, bublin 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dbulin 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, diblin 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, diblin 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dubiln 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dubin 6'), &nbsp; <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dublbin 6'), <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dubli 6'), &nbsp; <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dublini 6'), <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dublinn 6'), <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dubllin 6'), <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dubln 6'), &nbsp; <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dublni 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, duboin 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dulbin 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dulin 6'), &nbsp; <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dunlin 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dunlin6'), &nbsp; <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dublihn 6'), <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dubkin 6'), &nbsp;<span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dublihn 6'), <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, ddublin 6'), <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dubline 6'), <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dyublin 6'), <span class="cm-string">"1 place, dublin_6")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dyublin 6'), <span class="cm-string">"1 place, dublin_6")</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode(<span class="cm-string">'1 place, dubglin 6'), <span class="cm-string">"1 place, dublin_6")</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1194px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1194px;"></div></div></div></pre><p>Now, we will update the postcode normalise function to make our new tests pass.</p><h4 id='postcode-normalisation-function-2'>Postcode normalisation function</h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">normalise_dublin_postcode(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">address.<span class="cm-property">lower().<span class="cm-property">strip(<span class="cm-string">',. ')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"(apt|block) +(d\d+)", <span class="cm-string">r"\1==\2", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[, ]*\b[db]+y?[iunb]{1,2}[okgbil]{1,3}[nhei]{1,2} *(\d)", <span class="cm-string">r", dublin \1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r'\bd(ublin)? *6 *(west|w)\b', <span class="cm-string">'dublin_6w', <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r'\bdublin\.? *0?(\d+)', <span class="cm-string">r'dublin_\1', <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r'([a-z]{3,})dublin\.? *0?(\d+)', <span class="cm-string">r'\1, dublin_\2', <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" d[ /\.]*([012]?[0-9]w?)\b", <span class="cm-string">r" dublin_\1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"\b(dublin_([12]?[0-9]w?)),? \1$", <span class="cm-string">r", dublin_\2", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" ?,[, ]+", <span class="cm-string">r", ", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">"==", <span class="cm-string">r" ", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">address</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 287px;"></div><div class="CodeMirror-gutters" style="display: none; height: 287px;"></div></div></div></pre><p>Here is a link to the regex used for Dublin misspellings: <a href='https://regex101.com/r/GtTYKh/2' target='_blank' class='url'>https://regex101.com/r/GtTYKh/2</a></p><p>Now we have a robust function for normalising a Dublin Postcode in an address.</p><h3 id='extracting-dublin-postcode-from-an-address'>Extracting Dublin Postcode from an address</h3><p>Dublin postcodes now have a consistent pattern in the address string. This makes it easy to extract them.</p><h5 id='postcode-extraction-tests'>Postcode extraction tests</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_extract_dublin_postcode(<span class="cm-variable-2">self):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">ex.<span class="cm-property">extract_dublin_postcode_from_address(<span class="cm-string">'1 some place, dublin_9'), &nbsp; <span class="cm-string">"Dublin 9")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">ex.<span class="cm-property">extract_dublin_postcode_from_address(<span class="cm-string">'1 some place, dublin_14'), &nbsp;<span class="cm-string">"Dublin 14")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">ex.<span class="cm-property">extract_dublin_postcode_from_address(<span class="cm-string">'1 some place, dublin_6w'), &nbsp;<span class="cm-string">"Dublin 6W")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">ex.<span class="cm-property">extract_dublin_postcode_from_address(<span class="cm-string">'1 place, dublin_10, town'), <span class="cm-string">"Dublin 10")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">ex.<span class="cm-property">extract_dublin_postcode_from_address(<span class="cm-string">'1 place, town, dublin_6'), &nbsp;<span class="cm-string">"Dublin 6")</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 143px;"></div><div class="CodeMirror-gutters" style="display: none; height: 143px;"></div></div></div></pre><h5 id='postcode-extraction-function'>Postcode extraction function</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">extract_dublin_postcode_from_address(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">address.<span class="cm-property">lower().<span class="cm-property">strip(<span class="cm-string">' ,.')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">regex = <span class="cm-string">r'dublin_(\d+w?)'</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">regex_result = <span class="cm-variable">re.<span class="cm-property">search(<span class="cm-variable">regex, <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">postcode = <span class="cm-keyword">None</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">regex_result <span class="cm-keyword">is <span class="cm-keyword">not <span class="cm-keyword">None:</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">postcode = <span class="cm-string">f"Dublin {regex_result.group(1).upper()}"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">postcode</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 191px;"></div><div class="CodeMirror-gutters" style="display: none; height: 191px;"></div></div></div></pre><blockquote><p>Now we can successfully extract a Dublin Postcode from an address</p></blockquote><h4 id='remove-dublin-postcode-from-an-address'>Remove Dublin Postcode from an address</h4><h5 id='postcode-removal-tests'>Postcode removal tests</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_parse_address_of_dublin_postcode(<span class="cm-variable-2">self):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">pr.<span class="cm-property">parse_address_of_dublin_postcode(<span class="cm-string">'1 some place, dublin_9'), <span class="cm-string">"1 some place")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">pr.<span class="cm-property">parse_address_of_dublin_postcode(<span class="cm-string">'1 some place, dublin_14'), <span class="cm-string">"1 some place")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">pr.<span class="cm-property">parse_address_of_dublin_postcode(<span class="cm-string">'1 some place, dublin_6w'), <span class="cm-string">"1 some place")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">pr.<span class="cm-property">parse_address_of_dublin_postcode(<span class="cm-string">'1 place, dublin_10, town'), <span class="cm-string">"1 place, town")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">pr.<span class="cm-property">parse_address_of_dublin_postcode(<span class="cm-string">'1 place, town, dublin_6'), <span class="cm-string">"1 place, town")</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 143px;"></div><div class="CodeMirror-gutters" style="display: none; height: 143px;"></div></div></div></pre><h5 id='postcode-removal-function'>Postcode removal function</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">parse_address_of_dublin_postcode(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">address.<span class="cm-property">strip(<span class="cm-string">' ,.')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">regex = <span class="cm-string">r'dublin_(\d+w?)'</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-variable">regex, <span class="cm-string">',', <span class="cm-variable">address, <span class="cm-variable">flags=<span class="cm-variable">re.<span class="cm-property">IGNORECASE)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"\s*,[,\s]+", <span class="cm-string">', ', <span class="cm-variable">address)</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">address.<span class="cm-property">strip(<span class="cm-string">',. ')</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 143px;"></div><div class="CodeMirror-gutters" style="display: none; height: 143px;"></div></div></div></pre><h3 id='update-database-1'>Update database</h3><p>We will loop over the database and extract/remove Dublin Postcodes from address containing them.</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">pd.<span class="cm-property">read_sql_query(<span class="cm-string">'SELECT * FROM temp;', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">set_index(<span class="cm-string">'uuid', <span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">address_mod = <span class="cm-variable">df.<span class="cm-property">address_mod.<span class="cm-property">apply(<span class="cm-variable">nm.<span class="cm-property">normalise_dublin_postcode)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for <span class="cm-variable">row <span class="cm-keyword">in <span class="cm-variable">df.<span class="cm-property">copy().<span class="cm-property">itertuples():</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">postcode = <span class="cm-variable">ex.<span class="cm-property">extract_dublin_postcode_from_address(<span class="cm-variable">row.<span class="cm-property">address_mod)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">postcode <span class="cm-keyword">is <span class="cm-keyword">not <span class="cm-keyword">None:</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'ex_postcode'] = <span class="cm-variable">postcode</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'address_mod'] = <span class="cm-variable">pr.<span class="cm-property">parse_address_of_dublin_postcode(<span class="cm-variable">row.<span class="cm-property">address_mod)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur = <span class="cm-variable">conn.<span class="cm-property">cursor()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">execute(<span class="cm-string">f"DROP TABLE IF EXISTS temp;")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">to_sql(<span class="cm-string">'temp', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">close()</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 382px;"></div><div class="CodeMirror-gutters" style="display: none; height: 382px;"></div></div></div></pre><p>Looking at the results in the database, we can see that <strong>69,687</strong> Dublin Postcodes have been <strong>extracted</strong>.</p><p>Considering sales in Dublin account for about 150,000 rows in the database, this is a great return.</p><p><img src="images/db-postcode-2.png" referrerpolicy="no-referrer" alt="Screenshot 2021-05-04 at 10.37.11"></p><h2 id='county-extraction'>County Extraction</h2><p><img src="images/county.jpeg" referrerpolicy="no-referrer" alt="shutterstock-32309722-1" style="max-height: 400px;"></p><p>Finally, we will attempt to <strong>extract the county name</strong> from the end on an address. This will be <strong>more complicated</strong> than the previous two extractions.</p><p>There are 26 counties in the database. Initially we will look for one of these these surrounded by a longhand/shorthand naming of county.</p><h3 id='normalise-function'>Normalise function </h3><blockquote><h5 id='1-some-place-co-cork--1-some-place-cocork'>1 Some Place, co cork =&gt; 1 Some Place, co_cork</h5></blockquote><p>From scanning through the database, we have extracted some tests for our normalisation function. We are attempting to normalise county to <strong>co_{county_name}</strong></p><h5 id='county-normalisation-tests'>County normalisation tests</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_normalise_county_name(<span class="cm-variable-2">self):</pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place, co cork'), &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place, co. cork'), &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place, co.cork'), &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place co cork'), &nbsp; &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place  co cork'), &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place county cork'), <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place countycork'), &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place  cork'), &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place  cork.'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_name(<span class="cm-string">'1 Some Place, cork'), &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, co_cork")</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 263px;"></div><div class="CodeMirror-gutters" style="display: none; height: 263px;"></div></div></div></pre><h5 id='county-normalisation-function'>County normalisation function</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">normalise_county_name(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">counties = [<span class="cm-string">'carlow', <span class="cm-string">'cavan', <span class="cm-string">'clare', <span class="cm-string">'cork', <span class="cm-string">'donegal', <span class="cm-string">'down', <span class="cm-string">'dublin', <span class="cm-string">'fermanagh', <span class="cm-string">'galway', <span class="cm-string">'kerry',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'kildare', <span class="cm-string">'kilkenny', <span class="cm-string">'laois', <span class="cm-string">'leitrim', <span class="cm-string">'limerick', <span class="cm-string">'longford', <span class="cm-string">'louth', <span class="cm-string">'mayo', <span class="cm-string">'meath', <span class="cm-string">'monaghan',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'offaly', <span class="cm-string">'roscommon', <span class="cm-string">'sligo', <span class="cm-string">'tipperary', <span class="cm-string">'waterford', <span class="cm-string">'westmeath', <span class="cm-string">'wexford', <span class="cm-string">'wicklow']</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">address.<span class="cm-property">lower().<span class="cm-property">strip(<span class="cm-string">' ,.')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">counties_regex = <span class="cm-string">r"(" <span class="cm-operator">+ <span class="cm-string">'|'.<span class="cm-property">join(<span class="cm-variable">counties) <span class="cm-operator">+ <span class="cm-string">r")"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[ ,]+(county|co\.|co) *\.?" <span class="cm-operator">+ <span class="cm-variable">counties_regex, <span class="cm-string">r", co_\2", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[ ,]" <span class="cm-operator">+ <span class="cm-variable">counties_regex <span class="cm-operator">+ <span class="cm-string">r" ?(county|co\.|co)\b", <span class="cm-string">r", co_\1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"  +" <span class="cm-operator">+ <span class="cm-variable">counties_regex <span class="cm-operator">+ <span class="cm-string">r"$", <span class="cm-string">r", co_\1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r", ?" <span class="cm-operator">+ <span class="cm-variable">counties_regex <span class="cm-operator">+ <span class="cm-string">r"$", <span class="cm-string">r", co_\1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">address</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 287px;"></div><div class="CodeMirror-gutters" style="display: none; height: 287px;"></div></div></div></pre><h3 id='look-for-outliers-2'>Look for outliers</h3><p>We will do some investigation into the database to find outliers. Again, we will use DB Browser for Sqlite regex search for this.</p><h6 id='search-for-county-in-address-regex--countyco-a-z'>Search for County in address (regex: / (county|co\.?) [a-z]+$/)</h6><p><img src="images/db-postcode-3.png" referrerpolicy="no-referrer" alt="image-20210426121830279"></p><h6 id='seach-for-county-names-at-the-end-of-the-address-preceeded-by-a-space'>Seach for county names at the end of the address preceeded by a space</h6><p><img src="images/db-postcode-4.png" referrerpolicy="no-referrer" alt="image-20210426122635022"></p><p>Between these two initial searches, we have found almost 1,000 outliers. </p><p>After futher investigation, there are numerous mistakes that we can correct. Here are a few that we missed:</p><figure><table><thead><tr><th>address</th><th>error</th></tr></thead><tbody><tr><td>8 ash park heath, lucan, cco. dublin</td><td>county prefix misspelling</td></tr><tr><td>217 galloping green, stillorgan road, cunty dublin</td><td>county prefix misspelling</td></tr><tr><td>muckalee, ballyfoyle, cuonty kilkenny</td><td>county prefix misspelling</td></tr><tr><td>ballyrahan, tinahely, coounty wicklow</td><td>county prefix misspelling</td></tr><tr><td>st heliers, coast rd, fountainstownco cork</td><td>county prefix missing space</td></tr><tr><td>cloghoolia, sixmilebridge, county clqare</td><td>county name misspelling</td></tr><tr><td>ranafast, annagry, county donegak</td><td>county name misspelling</td></tr><tr><td>donore, multifarnham, west meath</td><td>county name misspelling</td></tr><tr><td>ballymacrown, baltimore, west cork</td><td>&#39;west cork&#39; not needed in address as baltimore is a unique town</td></tr><tr><td>liskillea, waterfall, near cork</td><td>&#39;near&#39; word unnecessary</td></tr><tr><td>springvale ballymaw, waterfall, near cork city</td><td>&#39;near&#39; and &#39;city&#39; words unnecessary</td></tr></tbody></table></figure><p>If we updated our normalisation function to account for all these errors, it would potentially become difficult to read.</p><p>What we will do is split normalisation into three functions:</p><ul><li>normalise county spelling mistakes</li><li>normalise county prefix spelling mistakes</li><li>normalise county name and prefix to a searchable pattern </li></ul><h3 id='normalise-county-spelling'>Normalise County Spelling</h3><h4 id='county-spelling-normalisation-tests'>County spelling normalisation tests</h4><p>Here is a subset of the tests written. </p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_normalise_county_spelling(<span class="cm-variable-2">self):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># = cork</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, corl'), &nbsp; &nbsp; <span class="cm-string">"1 some place, cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, cokr'), &nbsp; &nbsp; <span class="cm-string">"1 some place, cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, crok'), &nbsp; &nbsp; <span class="cm-string">"1 some place, cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, coork'), &nbsp; &nbsp; <span class="cm-string">"1 some place, cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># = donegal</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, dongal'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, donegal")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, doengal'), &nbsp; &nbsp; <span class="cm-string">"1 some place, donegal")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, donegak'), &nbsp; &nbsp; <span class="cm-string">"1 some place, donegal")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># = dublin</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, dubblin'), &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, dubin'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, dubliln'), &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, dublibn'), &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, dublibn'), &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_spelling(<span class="cm-string">'1 some place, dubllin'), &nbsp; &nbsp;<span class="cm-string">"1 some place, dublin")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  .....</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 430px;"></div><div class="CodeMirror-gutters" style="display: none; height: 430px;"></div></div></div></pre><h4 id='county-spelling-normalisation-function'>County spelling normalisation function</h4><p>There are several ways to normalise incorrect spelling. I have chosen to use regex.</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">normalise_county_spelling(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" c[la][lqare]{2,3}e$", <span class="cm-string">" clare", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" [co][corkl]{1,3}[rkl]$", <span class="cm-string">" cork", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" do[nega]+[lk]$", <span class="cm-string">" donegal", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" du[bl][biln]{1,3}ni?$", <span class="cm-string">" dublin", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" g[al]{1,2}w[ayt]{1,3}$", <span class="cm-string">" galway", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" k[ilfd]{1,3}[dar]{1,3}[ed]$", <span class="cm-string">" kildare", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" ki[lk]{1,2}[ken]{2,4}[yt]$", <span class="cm-string">" kilkenny", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" loais$", <span class="cm-string">" laois", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" le[it]rim$", <span class="cm-string">" leitrim", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" l[im]{1,2}[eri]{1,3}c[fk]{1,2}$", <span class="cm-string">" limerick", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" lon[gfo]{1,3}[rds]{1,2}$", <span class="cm-string">" longford", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"(?&lt;!the) l[ou][uthrg]+$", <span class="cm-string">" louth", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" m[maor]{1,2}[yo]{1,2}$", <span class="cm-string">" mayo", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" m[ae][aeth]+$", <span class="cm-string">" meath", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" m[oa][nagho]+$", <span class="cm-string">" monaghan", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" of[faly]+$", <span class="cm-string">" offaly", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" r[osd]{1,2}[cos]{1,3}mm[mon]{1,3}$", <span class="cm-string">" roscommon", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" s[li]{1,3}go$", <span class="cm-string">" sligo", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" tip{1,3}[eart]{1,5}y$", <span class="cm-string">" tipperary", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" wa[tr]er[forite]{1,4}d$", <span class="cm-string">" waterford", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" we[staer]{1,3}m[ea]{1,2}th$", <span class="cm-string">" westmeath", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[, ]+(west) meath", <span class="cm-string">r", westmeath", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" w[ex]{1,2}[fv][fords]{1,3}$", <span class="cm-string">" wexford", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" w[ic]{1,3}[kl]{1,2}[ow]{1,2}$", <span class="cm-string">" wicklow", <span class="cm-variable">address)</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">address</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 621px;"></div><div class="CodeMirror-gutters" style="display: none; height: 621px;"></div></div></div></pre><h3 id='normalise-county-prefix-spelling'>Normalise County Prefix Spelling</h3><h4 id='county-prefix-spelling-normalisation-tests'>County prefix spelling normalisation tests</h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_normalise_county_prefix_spelling(<span class="cm-variable-2">self):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, ci cork'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, cp cork'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, clo cork'), &nbsp; &nbsp; <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, col cork'), &nbsp; &nbsp; <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, ci cork'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, cd cork'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, ci cork'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, c cork'), &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, c0. cork'), &nbsp; &nbsp; <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, cco. cork'), &nbsp; &nbsp;<span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, o cork'), &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, cointy cork'), &nbsp;<span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, ccunty cork'), &nbsp;<span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, cunty cork'), &nbsp; <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, couty cork'), &nbsp; <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, couny cork'), &nbsp; <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, count cork'), &nbsp; <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, coutny cork'), &nbsp;<span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 some place, countuy cork'), <span class="cm-string">"1 some place, county cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># negative</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 place, old dublin road'), &nbsp; <span class="cm-string">"1 place, old dublin road")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county_prefix_spelling(<span class="cm-string">'1 place, i f s c dublin 1'), &nbsp; <span class="cm-string">"1 place, ifsc, dublin 1")</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 549px;"></div><div class="CodeMirror-gutters" style="display: none; height: 549px;"></div></div></div></pre><h4 id='county-prefix-spelling-normalisation-function'>County prefix spelling normalisation function</h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">normalise_county_prefix_spelling(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">counties = [<span class="cm-string">'carlow', <span class="cm-string">'cavan', <span class="cm-string">'clare', <span class="cm-string">'cork', <span class="cm-string">'donegal', <span class="cm-string">'down', <span class="cm-string">'dublin', <span class="cm-string">'fermanagh', <span class="cm-string">'galway', <span class="cm-string">'kerry',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'kildare', <span class="cm-string">'kilkenny', <span class="cm-string">'laois', <span class="cm-string">'leitrim', <span class="cm-string">'limerick', <span class="cm-string">'longford', <span class="cm-string">'louth', <span class="cm-string">'mayo', <span class="cm-string">'meath', <span class="cm-string">'monaghan',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'offaly', <span class="cm-string">'roscommon', <span class="cm-string">'sligo', <span class="cm-string">'tipperary', <span class="cm-string">'waterford', <span class="cm-string">'westmeath', <span class="cm-string">'wexford', <span class="cm-string">'wicklow']</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">counties_regex = <span class="cm-string">r"(" <span class="cm-operator">+ <span class="cm-string">'|'.<span class="cm-property">join(<span class="cm-variable">counties) <span class="cm-operator">+ <span class="cm-string">r")"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># mistakes</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" i f s c ", <span class="cm-string">" ifsc, ", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[ ,]+c[oc]{0,1}[iun]{1,2}[tnuy]{1,3} *" <span class="cm-operator">+ <span class="cm-variable">counties_regex, <span class="cm-string">r", county \1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[ ,]+c[doip0lc]{0,2} ?[\.\;\:]? *\.?" <span class="cm-operator">+ <span class="cm-variable">counties_regex, <span class="cm-string">r", county \1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[ ,]+o " <span class="cm-operator">+ <span class="cm-variable">counties_regex, <span class="cm-string">r", county \1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[ ,]" <span class="cm-operator">+ <span class="cm-variable">counties_regex <span class="cm-operator">+ <span class="cm-string">r" ?(county|co\.|co)\b", <span class="cm-string">r", county \1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"([a-z])(co\.?|county) " <span class="cm-operator">+ <span class="cm-variable">counties_regex, <span class="cm-string">r"\1, county \3", <span class="cm-variable">address)</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">address</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 334px;"></div><div class="CodeMirror-gutters" style="display: none; height: 334px;"></div></div></div></pre><h3 id='normalise-county'>Normalise County</h3><h4 id='normalise-county-tests'>Normalise County tests</h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">test_normalise_county(<span class="cm-variable-2">self):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, co cork'), &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, co. cork'), &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, co . cork'), &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, co; cork'), &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, co: cork'), &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, co.cork'), &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place co cork'), &nbsp; &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place  co cork'), &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place county cork'), <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place countycork'), &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place  cork'), &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place  cork.'), &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, cork'), &nbsp; &nbsp; &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'coast rd, fountainstownco cork'), <span class="cm-string">"coast rd, fountainstown, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># part of a county</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, west cork'), &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, nr cork'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, near cork'), &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, near cork city'), &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, north dublin'), &nbsp; &nbsp; <span class="cm-string">"1 some place, co_dublin")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, north tipperary'), &nbsp;<span class="cm-string">"1 some place, co_tipperary")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, south tipperary'), &nbsp;<span class="cm-string">"1 some place, co_tipperary")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 some place, city of dublin'), &nbsp; <span class="cm-string">"1 some place, co_dublin")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># county at end of address</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place tipperary'), &nbsp; &nbsp;<span class="cm-string">"1 some place, co_tipperary")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># remove mistakes</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, co'), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"1 some place")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, cork po'), &nbsp; &nbsp; <span class="cm-string">"1 some place, co_cork")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, port laois'), &nbsp;<span class="cm-string">"1 some place, portlaoise")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, port laoise'), <span class="cm-string">"1 some place, portlaoise")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># negative change</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, the louth'), &nbsp; <span class="cm-string">"1 some place, the louth")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">self.<span class="cm-property">assertEqual(<span class="cm-variable">nm.<span class="cm-property">normalise_county(<span class="cm-string">'1 Some Place, via louth'), &nbsp; <span class="cm-string">"1 some place, via louth")</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 812px;"></div><div class="CodeMirror-gutters" style="display: none; height: 812px;"></div></div></div></pre><h4 id='normalise-county-function'>Normalise County function</h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def <span class="cm-def">normalise_county(<span class="cm-variable">address: <span class="cm-builtin">str):</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">counties = [<span class="cm-string">'carlow', <span class="cm-string">'cavan', <span class="cm-string">'clare', <span class="cm-string">'cork', <span class="cm-string">'donegal', <span class="cm-string">'down', <span class="cm-string">'dublin', <span class="cm-string">'fermanagh', <span class="cm-string">'galway', <span class="cm-string">'kerry',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'kildare', <span class="cm-string">'kilkenny', <span class="cm-string">'laois', <span class="cm-string">'leitrim', <span class="cm-string">'limerick', <span class="cm-string">'longford', <span class="cm-string">'louth', <span class="cm-string">'mayo', <span class="cm-string">'meath', <span class="cm-string">'monaghan',</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'offaly', <span class="cm-string">'roscommon', <span class="cm-string">'sligo', <span class="cm-string">'tipperary', <span class="cm-string">'waterford', <span class="cm-string">'westmeath', <span class="cm-string">'wexford', <span class="cm-string">'wicklow']</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">counties_regex = <span class="cm-string">r"(" <span class="cm-operator">+ <span class="cm-string">'|'.<span class="cm-property">join(<span class="cm-variable">counties) <span class="cm-operator">+ <span class="cm-string">r")"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">address.<span class="cm-property">lower().<span class="cm-property">strip(<span class="cm-string">' ,.')</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># mistakes</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r" port laoise?$", <span class="cm-string">" portlaoise", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r' po$', <span class="cm-string">'', <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r', co$', <span class="cm-string">'', <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">normalise_county_spelling(<span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">normalise_county_prefix_spelling(<span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"county " <span class="cm-operator">+ <span class="cm-variable">counties_regex <span class="cm-operator">+ <span class="cm-string">r"$", <span class="cm-string">r"co_\1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"  +" <span class="cm-operator">+ <span class="cm-variable">counties_regex <span class="cm-operator">+ <span class="cm-string">r"$", <span class="cm-string">r", co_\1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r", ?" <span class="cm-operator">+ <span class="cm-variable">counties_regex <span class="cm-operator">+ <span class="cm-string">r"$", <span class="cm-string">r", co_\1", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[, ]+(west|near|nr) cork( city)?", <span class="cm-string">r", co_cork", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[, ]+(north|south) tipperary", <span class="cm-string">r", co_tipperary", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[, ]+(north) dublin", <span class="cm-string">r", co_dublin", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"[, ]+(city of dublin|dublin city)", <span class="cm-string">r", co_dublin", <span class="cm-variable">address)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">address = <span class="cm-variable">re.<span class="cm-property">sub(<span class="cm-string">r"(?&lt;!(the|via)) " <span class="cm-operator">+ <span class="cm-variable">counties_regex <span class="cm-operator">+ <span class="cm-string">r"$", <span class="cm-string">r", co_\2", <span class="cm-variable">address)</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">address</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 525px;"></div><div class="CodeMirror-gutters" style="display: none; height: 525px;"></div></div></div></pre><h3 id='update-database-2'>Update database</h3><p>Now we will loop over the database and extract/remove County names from address containing them.</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">pd.<span class="cm-property">read_sql_query(<span class="cm-string">'SELECT * FROM temp;', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">set_index(<span class="cm-string">'uuid', <span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">address_mod = <span class="cm-variable">df.<span class="cm-property">address_mod.<span class="cm-property">apply(<span class="cm-variable">nm.<span class="cm-property">normalise_county)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for <span class="cm-variable">row <span class="cm-keyword">in <span class="cm-variable">df.<span class="cm-property">copy().<span class="cm-property">itertuples():</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">county = <span class="cm-variable">ex.<span class="cm-property">extract_county_from_address(<span class="cm-variable">row.<span class="cm-property">address_mod)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">county <span class="cm-keyword">is <span class="cm-keyword">not <span class="cm-keyword">None:</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'ex_county'] = <span class="cm-variable">county</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'address_mod'] = <span class="cm-variable">pr.<span class="cm-property">parse_address_of_county(<span class="cm-variable">row.<span class="cm-property">address_mod)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur = <span class="cm-variable">conn.<span class="cm-property">cursor()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">execute(<span class="cm-string">f"DROP TABLE IF EXISTS temp;")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">to_sql(<span class="cm-string">'temp', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">close()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 382px;"></div><div class="CodeMirror-gutters" style="display: none; height: 382px;"></div></div></div></pre><p>Looking at the database, we can see that <strong>163,637</strong> County names have been <strong>extracted</strong>.</p><p>This is approx <strong>34%</strong> of rows in our database affected.</p><p><img src="images/db-county-1.png" referrerpolicy="no-referrer" alt="Screenshot 2021-05-04 at 11.20.26"></p><h2 id='combine-extracted-data-with-the-origional-dataset'>Combine Extracted Data with the origional Dataset</h2><p>We have extracted either an Eircode, Dublin Postcode or County from <strong>229,338</strong> rows in the database.</p><p>We will now combine this data with the original dataset.
In some cases, either the extracted County or Postcode won’t match what is in the County or Postcode column. In this case we will combine the two and comma-separate them.</p><p>Also, if we have extracted a Dublin Postcode from an address where the County is not listed as Dublin, we will add Dublin to the county column.</p><p>Theses rows that contain comma-separated values in the County or Dublin Postcode columns will have to be manually updated. </p><h4 id='get-origional-dataset-as-a-pandas-dataframe'>Get Origional Dataset as a pandas dataframe</h4><p>We will add the updated address to its own column(address_mod). </p><p>It is useful to have the original when manually updating conflicts.</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_orig = <span class="cm-variable">pd.<span class="cm-property">read_sql_query(<span class="cm-string">'SELECT * FROM ppr_all;', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_orig.<span class="cm-property">set_index(<span class="cm-string">'uuid', <span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_orig.<span class="cm-property">insert(<span class="cm-number">2, <span class="cm-string">'address_mod', <span class="cm-keyword">None)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_orig.<span class="cm-property">insert(<span class="cm-number">5, <span class="cm-string">'eircode', <span class="cm-keyword">None)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_orig.<span class="cm-property">head()</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 167px;"></div><div class="CodeMirror-gutters" style="display: none; height: 167px;"></div></div></div></pre><h4 id='combine-extracted-data'>Combine Extracted Data</h4><h5 id='eircode'>Eircode</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">pd.<span class="cm-property">read_sql_query(<span class="cm-string">'SELECT * FROM temp WHERE ex_eircode NOT NULL;', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for <span class="cm-variable">row <span class="cm-keyword">in <span class="cm-variable">df.<span class="cm-property">copy().<span class="cm-property">itertuples():</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">df_orig.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'address_mod'] = <span class="cm-variable">row.<span class="cm-property">address_mod.<span class="cm-property">title()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">df_orig.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'eircode'] = <span class="cm-variable">row.<span class="cm-property">ex_eircode</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 143px;"></div><div class="CodeMirror-gutters" style="display: none; height: 143px;"></div></div></div></pre><h5 id='postcode'>Postcode</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">pd.<span class="cm-property">read_sql_query(<span class="cm-string">'SELECT * FROM temp WHERE ex_postcode NOT NULL;', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">set_index(<span class="cm-string">'uuid', <span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for <span class="cm-variable">row <span class="cm-keyword">in <span class="cm-variable">df.<span class="cm-property">copy().<span class="cm-property">itertuples():</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ex_postcode = <span class="cm-variable">row.<span class="cm-property">ex_postcode</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">postcode = <span class="cm-variable">row.<span class="cm-property">postcode.<span class="cm-property">title()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">county = <span class="cm-variable">row.<span class="cm-property">county</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">postcode <span class="cm-keyword">is <span class="cm-keyword">None:</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df_orig.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'postcode'] = <span class="cm-variable">row.<span class="cm-property">ex_postcode</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">county <span class="cm-operator">!= <span class="cm-string">'Dublin':</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df_orig.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'county'] = <span class="cm-string">f"{county}, (ex_postcode: Dublin)"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else:</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">postcode <span class="cm-operator">!= <span class="cm-variable">ex_postcode:</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df_orig.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'postcode'] = <span class="cm-string">f"{postcode}, (ex_postcode: {ex_postcode})"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">county <span class="cm-operator">!= <span class="cm-string">'Dublin':</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df_orig.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'county'] = <span class="cm-string">f"{county}, (ex_postcode: Dublin)"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">df_orig.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'address_mod'] = <span class="cm-variable">row.<span class="cm-property">address_mod.<span class="cm-property">title()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 501px;"></div><div class="CodeMirror-gutters" style="display: none; height: 501px;"></div></div></div></pre><h5 id='county'>County</h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df = <span class="cm-variable">pd.<span class="cm-property">read_sql_query(<span class="cm-string">'SELECT * FROM temp WHERE ex_county NOT NULL;', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df.<span class="cm-property">set_index(<span class="cm-string">'uuid', <span class="cm-variable">inplace=<span class="cm-keyword">True)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for <span class="cm-variable">row <span class="cm-keyword">in <span class="cm-variable">df.<span class="cm-property">copy().<span class="cm-property">itertuples():</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ex_county = <span class="cm-variable">row.<span class="cm-property">ex_county</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">county = <span class="cm-variable">row.<span class="cm-property">county</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">county <span class="cm-operator">!= <span class="cm-variable">ex_county:</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df_orig.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'county'] = <span class="cm-string">f"{county}, (ex_county: {ex_county})"</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">df_orig.<span class="cm-property">at[<span class="cm-variable">row.<span class="cm-property">Index, <span class="cm-string">'address_mod'] = <span class="cm-variable">row.<span class="cm-property">address_mod.<span class="cm-property">title()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 287px;"></div><div class="CodeMirror-gutters" style="display: none; height: 287px;"></div></div></div></pre><h3 id='export-data-to-sqlite-db'>Export Data to Sqlite DB</h3><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.940298080444336px; left: 6.97296142578125px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>xxxxxxxxxx</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn = <span class="cm-variable">sqlite3.<span class="cm-property">connect(<span class="cm-string">'data/database.db')</pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur = <span class="cm-variable">conn.<span class="cm-property">cursor()</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">execute(<span class="cm-string">f"DROP TABLE IF EXISTS ppr_all_mod;")</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_orig.<span class="cm-property">to_sql(<span class="cm-string">'ppr_all', <span class="cm-variable">conn)</pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cur.<span class="cm-property">close()</pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conn.<span class="cm-property">close()</pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 143px;"></div><div class="CodeMirror-gutters" style="display: none; height: 143px;"></div></div></div></pre><h2 id='conclusion'>Conclusion</h2>
<p>We set out to extract Eircode, Postcode and County from the address string in the Property Price Register. To do this we normalised the information in the string to add structure where it was missing.</p>
<p>Through a TDD approach, we were able to successfully extract:</p>
<p><strong>35</strong> Eircodes</p>
<p><strong>69,687</strong> Dublin Postcodes</p>
<p><strong>163,637</strong> Counties</p>
<p>This solution is not without its failings. There are conflicts due to inaccurate input of address, postcode or county in the original dataset.</p><p>The number of conflicts are:</p><p><strong>2,068</strong> Dublin Postcodes</p><p><strong>1,038</strong> Counties</p>
<p><img src="images/conclusion.png" referrerpolicy="no-referrer" alt="image-20210504150250705"></p>
<p>There are ways to reduce these conflicts programatically, but that&#39;s for another blog.</p>
<p>All the code for this blog is available to view on <a href="https://github.com/bglynch/code_scratchpad/tree/master/blog/parsing-the-property-price-register-part-1" target="_blank">Github</a></p>
<p>This blog can also be read on <a href="https://bglynch.medium.com/parsing-the-property-price-register-7b4ee44d7203" target="_blank">Medium</a></p>
</div>
</div>
</body>
</html>